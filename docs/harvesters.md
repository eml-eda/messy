Harvesters in MESSY are viewed in 2 different categories, batteries and sources. Batteries are more complex and contain by default AMS level simulation, while sources are defined in a simpler way.

Currently the power scheduling tries to use all the power generated by the sources to contain the system load and eccesses are handled uniformly by the batteries.

In the future, this aspect could be analyzed more and bring more control over power scheduling algorithms,

## Batteries

The batteries are the most complex harvester in MESSY. The block representing a battery is the following:

![alt text](images/battery.png)

Internally, it is modeled as a first-order RC circuit using the ELN (Electrical Linear Network) model available in SystemC-AMS.

![alt text](images/battery_circuit_model.png)

### Signals Summary

A summary of the signals is shown in the table below:

| Signal | Direction | Connected to | Description |
| --- | --- | --- | --- |
| i | input | Battery Converter | Current |
| v | output | Battery Converter | Voltage |
| soc | output | - | State of Charge |

### Input Signals

The input signals are:

- **i**: This signal is a double.

### Output Signals

The output signals are:

- **v**: This signal is a double. It represents the voltage of the battery.
- **soc**: This signal is a double and represents the State of Charge of the battery. It is an output of the whole system, since it should be read from the top level module. 

### Definition in the JSON file
A battery is defined through several parameters, following an example of a battery called `panasonic_batt`:

```JSON
"panasonic_batt" : {
    "harvester_type":"battery",
    "tracing":{
        ...
    },
    "vref":3.8,
    "soc_init" : 100,
    "soc_end" : 0,
    "capacity":32,
    "self_discharge":{
        "resolution":{
            "unit":"SC_S",
            "mult":1
        },
        "value":0.001
    },
    "converter" : {
        ...
    }
}
```

The firs parameter is the `harvester_type` one, this has to be set to battery, then tracing can be set as well.

To continue a slate of battery related paramters are present, these are:

- `vref`: reference voltage in Volts
- `soc_init`: starting State of Charge of the battery
- `soc_end`: battery State of Charge that should trigger the termination of the simulation
- `capacity`: battery nominal capacity in mAh
- `self_discharge`: object that represent the self dischargment of a battery, parametrized by a resolution object and a `value`, each resolution time the value will be discharged from the battery
- `converter`: optionally MESSY allows harvesters to define a converter (better described in [Converters](converters.md))

## Photovoltaic Panel

Another type of harvester supported by MESSY is the Photovoltaic cell. It's block is as follows:

![alt text](images/pv_panel.png)

### Signals Summary

A summary of the signals is shown in the table below:

| Signal | Direction | Connected to | Description |
| --- | --- | --- | --- |
| i | output | Photovoltaic Converter | Current |
| v | output | Photovoltaic Converter | Voltage |

### Output Signals

The output signals are:

- **i**: This signal is a double. It represents the current generated by the photovoltaic cell.
- **v**: This signal is a double. It represents the voltage of the photovoltaic cell.


### Definition in the JSON file

The sources are defined similarly, here is an example:

```JSON
"photovoltaic" : {
    "harvester_type" :"source",
    "vref" :{
        "input_file":"input_files/gmonths.txt",
        "lut":{
            "input_values":[250,500,750,1000],
            "voltage_values":[2.9367,3.0710,3.1334,3.1689]
        }
    },
    "iref":{
        "input_file":"input_files/gmonths.txt",
        "lut":{
            "input_values":[250,500,750,1000],
            "current_values":[13.4031,27.2251,41.8848,56.7245]
        }
    },
    "converter" : {
        ...
    }
}
```

The firs parameter is the `harvester_type` one, this has to be set to source, then tracing can be set as well as a converter.

The specific parameters regards the enhanced input values such as `iref` and `vref`, these input values can be set statically, or to simulate more precisely natural conditions, they can be retrieved from an input file and generated by a [LUT](lut.md).